#!/bin/sh

cli=$HOME/.yawm/clients
ctl=$HOME/.yawm/.control
tmp=$HOME/.yawm/tmp
out=$tmp/screens

present()
{
	for item in $list; do
		if [ "$item" = "$1" ]; then
			return 0
		fi
	done
	return 1
}

while read var val; do
	case "$var" in
	seq*) seq=$val;;
	esac
done < $cli

echo list-clients > $ctl

found=0
count=0
while :; do
	while read var val; do
		case "$var" in
		seq*)
			if [ "$seq" != "$val" ]; then
				found=1
				break
			fi
			;;
		esac
	done < $cli
	if [ $found -eq 1 -o $count -gt 5000 ]; then
		break
	fi
	count=$((count + 1))
done

mkdir -p $tmp
printf "" > $out
list=''

while read scr tag win status pid name; do
	case "$scr" in
	seq*) continue;;
	esac

	if present $scr; then
		continue
	fi

	eval "list=\"\$list \$scr screen\$scr\""
	printf "$scr\tscreen$scr\n" >> $out
done < $cli

menu -c 9 -r 5 -i -f $out |
while read scr line; do
	echo "focus-screen $scr" > $ctl
	exit 0
done
