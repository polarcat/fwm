#!/bin/sh

. $base_/menu "wins" "wincfg"

color1="#f8f8f8"
color2="#101010"
image=''
w=24
h=24

echo "<table class=blank>
<tr>
<td class=info style=text-align:center;>&#xf057;</td>
<td class=info>title</td>
<td class=info>command</td>
<td class=info>process</td>
<td class=info>window</td>
</tr>"
wmctrl -l -p | sort |
while read wid desktop pid user name; do
	i=$((i + 1))
	if [ $((i % 2)) -eq 0 ]; then
		style=''
		bgcolor="transparent"
	else
		style="style=background-color:$color1;"
		bgcolor="$color1"
	fi

	if [ $pid -ne 0 ]; then
		while read val; do cmd=$val; done < /proc/$pid/comm
	fi

	icon=$(xprop -id $wid | grep -E "^WM_CLASS.*=" | cut -f2 -d'"')
	case "$icon" in
	*[Tt]erm*) glyph="[&#xf120;";;
	[Cc][Pp][Uu]*|*[Mm]on*) glyph="&#xf1fe;";;
	*[Dd]ict*) glyph="&#xf02d;";;
	[Nn]avigator|[Bb]rowser) glyph="&#xf0ac;";;
	[Cc]hrom*) glyph="&#xf268;";;
	[Ff]irefox) glyph="&#xf269;";;
	*[Cc]lock*) glyph="&#xf017;";;
	*) glyph="&#xf013;";;
	esac
	echo "<tr $style>
<td class=symbol>
<a class=symbol style=color:#DE5958; href=cgi?close=$wid>&#xf00d;</a>
</td>
<td class=pad>
<form action=cgi? method=get>
<button class=framed title=show window type=submit name=close value=$wid>
<table class=button>
<tr>
<td class=pad>$glyph&nbsp;&nbsp;$name</td>
</tr>
</table>
</button>
</form>
</td>
<td class=pad title=command>$cmd</td>
<td class=pad><a href=cgi?pidinfo=$pid title='show details'>$pid</a></td>
<td class=pad><a href=cgi?wininfo=$wid title='show details'>$wid</a></td>
</tr>"
done
echo '</table>'

. $base_/tail
